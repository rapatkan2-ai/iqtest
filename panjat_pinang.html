<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Panjat Pinang - MindTest.id</title>
    <link href="styles.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700;900&display=swap"
        rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'fun': ['Fredoka', 'sans-serif'], 'body': ['Nunito', 'sans-serif'] },
                    colors: {
                        'p1-color': '#002060', 'p2-color': '#C00000',
                        'wood': '#8B4513', 'wood-light': '#A0522D'
                    },
                    animation: { 'wiggle': 'wiggle 0.5s ease-in-out infinite' },
                    keyframes: { wiggle: { '0%, 100%': { transform: 'rotate(-3deg)' }, '50%': { transform: 'rotate(3deg)' } } }
                }
            }
        }
    </script>
    <style>
        body {
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .btn-touch:active {
            transform: scale(0.95);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-radius: 1.5rem;
            cursor: grab;
            touch-action: none;
        }

        .glass-card:active {
            cursor: grabbing;
        }

        .numpad-btn {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-family: 'Fredoka', sans-serif;
            font-size: 1.25rem;
            color: #4A5568;
            transition: all 0.1s;
        }

        .numpad-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .go-btn {
            background: #3B82F6;
            color: white;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .go-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .pole-texture {
            background: linear-gradient(90deg, #654321 0%, #8B4513 20%, #A0522D 50%, #8B4513 80%, #654321 100%);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-100 to-blue-50 font-body h-screen w-screen flex flex-col text-gray-800">

    <!-- Nav -->
    <div class="fixed top-4 left-4 z-50">
        <button onclick="window.location.href='playground_ifp.html'"
            class="btn-touch bg-white h-12 w-12 rounded-xl shadow-lg flex items-center justify-center text-gray-600 hover:text-blue-500"><span
                class="material-icons">home</span></button>
    </div>
    <div class="fixed top-4 right-4 z-50">
        <button onclick="toggleFullscreen()"
            class="btn-touch bg-white h-12 w-12 rounded-xl shadow-lg flex items-center justify-center text-gray-600 hover:text-blue-500"><span
                class="material-icons">fullscreen</span></button>
    </div>

    <main id="app" class="flex-grow relative w-full h-full flex items-center justify-center">

        <!-- 1. MODE -->
        <section id="screen-mode" class="text-center w-full max-w-5xl px-4 animate-fade-in-up">
            <h1
                class="font-fun text-7xl md:text-8xl font-bold text-gray-800 mb-2 drop-shadow-xl tracking-wider text-orange-600">
                PANJAT PINANG</h1>
            <p class="text-2xl text-gray-500 mb-12">Lomba Matematika Tradisional</p>
            <div class="flex flex-col md:flex-row gap-6 justify-center">
                <button onclick="setMode('1v1')"
                    class="btn-touch bg-white border-b-8 border-blue-200 hover:border-blue-400 p-8 rounded-3xl shadow-xl flex flex-col items-center w-72 active:border-b-0">
                    <span class="text-6xl mb-4">üßó‚Äç‚ôÇÔ∏èüßó‚Äç‚ôÄÔ∏è</span>
                    <span class="font-fun text-3xl font-bold text-gray-700">Duel (1 vs 1)</span>
                </button>
                <button onclick="setMode('race')"
                    class="btn-touch bg-white border-b-8 border-green-200 hover:border-green-400 p-8 rounded-3xl shadow-xl flex flex-col items-center w-72 active:border-b-0">
                    <span class="text-6xl mb-4">üèÅüèÉ‚Äç‚ôÇÔ∏è</span>
                    <span class="font-fun text-3xl font-bold text-gray-700">Race (4 Player)</span>
                </button>
            </div>
        </section>

        <!-- 2. DIFFICULTY -->
        <section id="screen-diff" class="hidden text-center w-full max-w-6xl px-4">
            <h1 class="font-fun text-6xl font-bold text-gray-800 mb-8">TINGKAT KESULITAN</h1>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <button onclick="setDiff('easy')"
                    class="btn-touch bg-white border-l-8 border-green-400 p-6 rounded-xl shadow-md hover:bg-green-50">
                    <div class="text-2xl font-bold text-green-600">MUDAH</div>
                    <div class="text-gray-400">1 - 10</div>
                </button>
                <button onclick="setDiff('medium')"
                    class="btn-touch bg-white border-l-8 border-yellow-400 p-6 rounded-xl shadow-md hover:bg-yellow-50">
                    <div class="text-2xl font-bold text-yellow-600">SEDANG</div>
                    <div class="text-gray-400">1 - 20</div>
                </button>
                <button onclick="setDiff('hard')"
                    class="btn-touch bg-white border-l-8 border-orange-400 p-6 rounded-xl shadow-md hover:bg-orange-50">
                    <div class="text-2xl font-bold text-orange-600">SULIT</div>
                    <div class="text-gray-400">10 - 50</div>
                </button>
                <button onclick="setDiff('expert')"
                    class="btn-touch bg-white border-l-8 border-red-400 p-6 rounded-xl shadow-md hover:bg-red-50">
                    <div class="text-2xl font-bold text-red-600">AHLI</div>
                    <div class="text-gray-400">10 - 100</div>
                </button>
            </div>
            <button onclick="show('mode')" class="mt-8 text-gray-400 font-bold">KEMBALI</button>
        </section>

        <!-- 3. OPS -->
        <section id="screen-ops" class="hidden text-center w-full max-w-5xl px-4 animate-fade-in-up">
            <h1 class="font-fun text-6xl font-bold text-gray-800 mb-8">OPERASI HITUNG</h1>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Buttons updated to call setOp -->
                <button onclick="setOp('+')"
                    class="btn-touch bg-blue-100 border-b-8 border-blue-300 hover:bg-blue-200 p-8 rounded-3xl shadow-lg">
                    <div class="text-6xl mb-2 font-bold text-blue-600">+</div>
                    <div class="font-bold text-2xl text-blue-700">Jumlah</div>
                </button>
                <button onclick="setOp('-')"
                    class="btn-touch bg-red-100 border-b-8 border-red-300 hover:bg-red-200 p-8 rounded-3xl shadow-lg">
                    <div class="text-6xl mb-2 font-bold text-red-600">-</div>
                    <div class="font-bold text-2xl text-red-700">Kurang</div>
                </button>
                <button onclick="setOp('x')"
                    class="btn-touch bg-amber-100 border-b-8 border-amber-300 hover:bg-amber-200 p-8 rounded-3xl shadow-lg">
                    <div class="text-6xl mb-2 font-bold text-amber-600">√ó</div>
                    <div class="font-bold text-2xl text-amber-700">Kali</div>
                </button>
                <button onclick="setOp('/')"
                    class="btn-touch bg-teal-100 border-b-8 border-teal-300 hover:bg-teal-200 p-8 rounded-3xl shadow-lg">
                    <div class="text-6xl mb-2 font-bold text-teal-600">√∑</div>
                    <div class="font-bold text-2xl text-teal-700">Bagi</div>
                </button>
            </div>
            <button onclick="show('diff')" class="mt-12 text-gray-400 font-bold hover:text-gray-600">KEMBALI</button>
        </section>

        <!-- 4. SETUP -->
        <section id="screen-setup" class="hidden w-full h-full flex flex-col items-center justify-center relative">
            <h2 class="text-3xl font-bold text-gray-600 mb-8">PILIH KARAKTER</h2>
            <div id="setup-container" class="flex w-full gap-4 px-8 justify-center"></div>
            <div id="start-overlay"
                class="absolute inset-0 bg-black/40 hidden flex items-center justify-center backdrop-blur-sm z-20">
                <button onclick="startMatch()"
                    class="bg-gradient-to-t from-orange-600 to-orange-400 text-white font-fun text-4xl px-16 py-6 rounded-full shadow-2xl animate-bounce border-4 border-white">PANJAT!</button>
            </div>
        </section>

        <!-- 5. GAME (FLOATING DRAGGABLE) -->
        <section id="screen-game" class="hidden absolute inset-0 w-full h-full overflow-hidden">

            <!-- Game Visuals (Center) -->
            <div class="absolute inset-0 z-0 flex items-center justify-center pointer-events-none">
                <div class="w-full h-full relative" id="poles-container">
                    <!-- Inject Poles Here -->
                </div>
            </div>

            <!-- UI Inputs (Bottom Draggable) -->
            <div class="absolute inset-0 z-10 pointer-events-none" id="ui-layer">
                <!-- Draggable Cards Injected Here -->
            </div>

        </section>

        <!-- 6. RESULT -->
        <section id="screen-result"
            class="hidden absolute inset-0 bg-black/80 backdrop-blur-md z-50 flex items-center justify-center">
            <div
                class="bg-white rounded-[3rem] p-12 text-center max-w-4xl w-full mx-4 shadow-2xl border-8 border-orange-400 animate-bounce-in">
                <div class="text-9xl mb-6">üèÜ</div>
                <h2 id="result-title" class="font-fun text-6xl font-bold text-gray-800 mb-4">WINNER!</h2>
                <div id="result-text" class="text-3xl text-gray-600 font-bold mb-10">...</div>
                <div class="flex gap-4 justify-center">
                    <button onclick="startGameFlow()"
                        class="btn-touch bg-green-500 text-white font-bold py-4 px-10 rounded-2xl shadow-lg">MAIN
                        LAGI</button>
                    <button onclick="window.location.href='playground_ifp.html'"
                        class="btn-touch bg-gray-200 text-gray-700 font-bold py-4 px-10 rounded-2xl shadow-lg">MENU</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        // CONFIG
        const MAX_HEIGHT = 100;
        let mode = '1v1', diff = 'medium', op = '+';
        let state = { players: [], over: false };
        let COLORS = ['#FFE66D', '#FF6B6B', '#4ECDC4', '#1A535C'];
        let CHARS = ['üêµ', 'üê®', 'üêº', 'üêà', 'ü¶Å', 'üê∏'];
        const PRIZES = ['üéÅ', 'üö≤', 'üì∫', 'üéÆ'];

        // UTILS
        const $ = id => document.getElementById(id);
        const toggleFullscreen = () => { if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(() => { }); else document.exitFullscreen(); };
        const show = id => { document.querySelectorAll('section').forEach(s => s.classList.add('hidden')); $(`screen-${id}`).classList.remove('hidden'); };

        // DRAG (Robust)
        function makeDraggable(el) {
            let isDragging = false;
            let shiftX, shiftY;

            const onStart = (e) => {
                if (e.target.closest('button')) return;

                const hint = el.querySelector('[id^="hint-"]'); if (hint) hint.remove();

                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const rect = el.getBoundingClientRect();
                const parentRect = el.offsetParent.getBoundingClientRect();

                shiftX = clientX - rect.left;
                shiftY = clientY - rect.top;

                isDragging = true;

                const relLeft = rect.left - parentRect.left;
                const relTop = rect.top - parentRect.top;

                el.style.position = 'absolute';
                el.style.left = relLeft + 'px';
                el.style.top = relTop + 'px';
                el.style.bottom = 'auto';
                el.style.right = 'auto';
                el.style.transform = 'none';
                el.style.zIndex = 100;
            };

            const onMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();

                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const parentRect = el.offsetParent.getBoundingClientRect();
                el.style.left = (clientX - shiftX - parentRect.left) + 'px';
                el.style.top = (clientY - shiftY - parentRect.top) + 'px';
            };

            const onEnd = () => { isDragging = false; el.style.zIndex = 10; };

            el.addEventListener('mousedown', onStart);
            window.addEventListener('mousemove', onMove);
            window.addEventListener('mouseup', onEnd);
            el.addEventListener('touchstart', onStart, { passive: false });
            window.addEventListener('touchmove', onMove, { passive: false });
            window.addEventListener('touchend', onEnd);
        }

        // FLOW
        function startGameFlow() { toggleFullscreen(); show('mode'); }
        function setMode(m) { mode = m; show('diff'); }
        function setDiff(d) { diff = d; show('ops'); }
        function setOp(o) {
            op = o;
            state.players = [];
            let count = mode === '1v1' ? 2 : 4;
            for (let i = 0; i < count; i++) state.players.push({ id: i, char: null, h: 0, q: null, input: '' });
            renderSetup(); show('setup');
        }

        // SETUP
        function renderSetup() {
            const container = $('setup-container'); container.innerHTML = '';
            state.players.forEach((p, i) => {
                const col = document.createElement('div');
                col.className = `glass-card flex-1 p-4 flex flex-col items-center max-w-[200px] gap-2 border-t-8`;
                col.style.borderColor = COLORS[i];
                let btns = '';
                CHARS.forEach(c => btns += `<button onclick="pickChar(${i},'${c}')" class="cbtn-${i} text-3xl p-1 rounded hover:bg-white/50 transition transform hover:scale-110">${c}</button>`);
                col.innerHTML = `<h3 class="font-bold text-2xl mb-2 text-gray-700">P${i + 1}</h3><div class="grid grid-cols-2 gap-1 mb-auto">${btns}</div><div id="stat-${i}" class="font-bold text-gray-400 mt-2 text-sm">Pilih...</div>`;
                container.appendChild(col);
            });
            $('start-overlay').classList.add('hidden');
        }

        function pickChar(pid, c) {
            state.players[pid].char = c;
            document.querySelectorAll(`.cbtn-${pid}`).forEach(b => {
                b.className = `cbtn-${pid} text-3xl p-1 rounded transition transform`;
                if (b.innerText === c) b.className += ` bg-orange-200 border border-orange-400 scale-125`;
            });
            $(`stat-${pid}`).innerHTML = `<span class="text-green-500">OK!</span>`;
            if (state.players.every(p => p.char)) $('start-overlay').classList.remove('hidden');
        }

        // MATCH
        function startMatch() {
            state.over = false;
            state.players.forEach(p => { p.h = 0; p.input = ''; p.q = null; });

            // Build Poles
            const poles = $('poles-container'); poles.innerHTML = '';
            state.players.forEach((p, i) => {
                const pole = document.createElement('div');
                pole.className = "relative h-full flex flex-col items-center justify-end float-left";
                pole.style.width = `${100 / state.players.length}%`;
                pole.innerHTML = `
                    <div class="absolute top-4 text-4xl animate-bounce z-10">${PRIZES[i % PRIZES.length]}</div>
                    <div class="pole-texture w-4 md:w-8 h-[90%] rounded-t-full relative">
                         <div id="sprite-${i}" class="absolute bottom-0 left-1/2 transform -translate-x-1/2 transition-all duration-300 text-4xl md:text-5xl drop-shadow-md" style="bottom: 0%;">
                            ${p.char}
                         </div>
                         <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 font-bold text-white bg-black/30 px-2 rounded text-xs whitespace-nowrap">P${i + 1}</div>
                    </div>
                `;
                poles.appendChild(pole);
            });

            // Build Draggable Inputs (Bottom)
            const uiLayer = $('ui-layer'); uiLayer.innerHTML = '';
            const widthPercent = 100 / state.players.length;

            state.players.forEach((p, i) => {
                const card = document.createElement('div');
                const leftPos = (i * widthPercent) + (widthPercent / 2);

                card.className = `glass-card absolute p-3 flex flex-col gap-2 pointer-events-auto transform -translate-x-1/2 transition-shadow hover:shadow-2xl`;
                card.style.width = '240px';
                card.style.bottom = '20px';
                card.style.left = `${leftPos}%`;
                card.style.borderTop = `6px solid ${COLORS[i]}`;

                card.innerHTML = `
                    <div id="hint-${i}" class="absolute -top-12 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-sm font-bold shadow-lg animate-bounce whitespace-nowrap z-50 pointer-events-none">
                        üëá Klik dan hold untuk geser kalkulator
                        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-yellow-400 rotate-45"></div>
                    </div>
                    <div class="rounded-lg p-2 text-center text-white font-fun text-xl font-bold shadow mb-1 cursor-grab active:cursor-grabbing select-none flex justify-between items-center px-4" style="background-color:${COLORS[i]}">
                        <div class="flex items-center"><span class="material-icons text-white/50 mr-1 text-sm">drag_indicator</span><span>P${i + 1}</span></div>
                        <span id="q-${i}">...</span>
                    </div>
                    <div id="in-${i}" class="bg-white rounded h-10 flex items-center justify-center font-bold text-2xl text-gray-700 shadow-inner tracking-widest border border-gray-200 mb-1"></div>
                     <div class="grid grid-cols-3 gap-1">
                        ${[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => `<button class="numpad-btn h-10 text-xl" onclick="handleIn(${i},'${n}')">${n}</button>`).join('')}
                        <button class="numpad-btn bg-gray-100 text-gray-400 h-10">.</button>
                        <button class="numpad-btn h-10 text-xl" onclick="handleIn(${i},'0')">0</button>
                        <button class="numpad-btn bg-red-500 text-white font-bold h-10" onclick="handleIn(${i},'C')">C</button>
                    </div>
                    <button class="go-btn rounded-lg py-2 font-bold text-lg w-full mt-1" onclick="handleIn(${i},'OK')">Jawab</button>
                `;

                makeDraggable(card);
                uiLayer.appendChild(card);
                nextQ(i);
            });

            show('game');
        }

        // LOGIC
        function nextQ(i) {
            let min, max;
            if (diff === 'easy') { min = 1; max = 10; }
            else if (diff === 'medium') { min = 1; max = 20; }
            else if (diff === 'hard') { min = 10; max = 50; }
            else { min = 10; max = 100; }

            let a, b, symbol;
            if (op === '+') { a = Math.floor(Math.random() * (max - min) + min); b = Math.floor(Math.random() * max + 1); symbol = '+'; }
            else if (op === '-') { a = Math.floor(Math.random() * (max - min) + min); b = Math.floor(Math.random() * a); symbol = '-'; }
            else if (op === 'x') { let m = diff === 'easy' ? 5 : diff === 'medium' ? 10 : 20; a = Math.floor(Math.random() * m + 1); b = Math.floor(Math.random() * 10 + 1); symbol = '√ó'; }
            else { let m = diff === 'easy' ? 5 : diff === 'medium' ? 10 : 20; let v2 = Math.floor(Math.random() * m + 1); let v1 = Math.floor(Math.random() * 10 + 1); b = v2; a = v1 * v2; symbol = '√∑'; }

            if (op === '+') state.players[i].q = { t: `${a} ${symbol} ${b} = ?`, a: a + b };
            else if (op === '-') state.players[i].q = { t: `${a} ${symbol} ${b} = ?`, a: a - b };
            else if (op === 'x') state.players[i].q = { t: `${a} ${symbol} ${b} = ?`, a: a * b };
            else if (op === '/') state.players[i].q = { t: `${a} ${symbol} ${b} = ?`, a: a / b };

            $(`q-${i}`).innerText = state.players[i].q.t;
        }

        function handleIn(i, k) {
            if (state.over) return;
            let p = state.players[i], el = $(`in-${i}`);
            if (k === 'C') { p.input = ''; }
            else if (k === 'OK') { check(i); return; }
            else if (p.input.length < 5) { p.input += k; }
            el.innerText = p.input;
        }

        function check(i) {
            let p = state.players[i], el = $(`in-${i}`);
            if (parseInt(p.input) === p.q.a) {
                el.classList.add('text-green-500', 'bg-green-50');
                p.h += 10;
                updateVis(i);
                if (p.h >= 90) end(i);
                else { p.input = ''; setTimeout(() => { el.innerText = ''; el.classList.remove('text-green-500', 'bg-green-50'); nextQ(i); }, 200); }
            } else {
                el.classList.add('text-red-500', 'bg-red-50');
                p.h = Math.max(0, p.h - 5);
                updateVis(i);
                setTimeout(() => el.classList.remove('text-red-500', 'bg-red-50'), 500);
            }
        }

        function updateVis(i) {
            $(`sprite-${i}`).style.bottom = `${state.players[i].h}%`;
            $(`sprite-${i}`).classList.add('scale-110');
            setTimeout(() => $(`sprite-${i}`).classList.remove('scale-110'), 200);
        }

        function end(i) {
            state.over = true;
            $(`result-title`).className = `font-fun text-6xl font-bold mb-4`;
            $(`result-title`).style.color = COLORS[i];
            $(`result-text`).innerText = `PEMAIN ${i + 1} MENANG! \n Mencapai puncak terlebih dahulu!`;
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            show('result');
        }

    </script>
</body>

</html>



